{"ast":null,"code":"import React,{createContext,useContext,useEffect,useRef,useState}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const WebSocketContext=/*#__PURE__*/createContext();export const WebSocketProvider=_ref=>{let{children}=_ref;const[isConnected,setIsConnected]=useState(false);const[currentGameId,setCurrentGameId]=useState(null);const wsRef=useRef(null);const reconnectTimeoutRef=useRef(null);const reconnectAttempts=useRef(0);const maxReconnectAttempts=5;const connect=()=>{const token=localStorage.getItem('poker_token');if(!token)return;const wsUrl=process.env.REACT_APP_WS_URL||'ws://localhost:5050';wsRef.current=new WebSocket(wsUrl);wsRef.current.onopen=()=>{console.log('WebSocket connected');setIsConnected(true);reconnectAttempts.current=0;// Authenticate the connection\nwsRef.current.send(JSON.stringify({type:'auth',token}));};wsRef.current.onclose=()=>{console.log('WebSocket disconnected');setIsConnected(false);// Attempt to reconnect\nif(reconnectAttempts.current<maxReconnectAttempts){reconnectAttempts.current++;const delay=Math.min(1000*Math.pow(2,reconnectAttempts.current),10000);reconnectTimeoutRef.current=setTimeout(()=>{console.log(\"Attempting to reconnect (\".concat(reconnectAttempts.current,\"/\").concat(maxReconnectAttempts,\")\"));connect();},delay);}};wsRef.current.onerror=error=>{console.error('WebSocket error:',error);};};const joinGame=gameId=>{if(wsRef.current&&wsRef.current.readyState===WebSocket.OPEN){wsRef.current.send(JSON.stringify({type:'join_game',gameId}));setCurrentGameId(gameId);}};const leaveGame=()=>{setCurrentGameId(null);};const sendMessage=message=>{if(wsRef.current&&wsRef.current.readyState===WebSocket.OPEN){wsRef.current.send(JSON.stringify(message));}};useEffect(()=>{connect();return()=>{if(reconnectTimeoutRef.current){clearTimeout(reconnectTimeoutRef.current);}if(wsRef.current){wsRef.current.close();}};},[]);const value={isConnected,currentGameId,joinGame,leaveGame,sendMessage,ws:wsRef.current};return/*#__PURE__*/_jsx(WebSocketContext.Provider,{value:value,children:children});};export const useWebSocket=()=>{const context=useContext(WebSocketContext);if(!context){throw new Error('useWebSocket must be used within a WebSocketProvider');}return context;};","map":{"version":3,"names":["React","createContext","useContext","useEffect","useRef","useState","jsx","_jsx","WebSocketContext","WebSocketProvider","_ref","children","isConnected","setIsConnected","currentGameId","setCurrentGameId","wsRef","reconnectTimeoutRef","reconnectAttempts","maxReconnectAttempts","connect","token","localStorage","getItem","wsUrl","process","env","REACT_APP_WS_URL","current","WebSocket","onopen","console","log","send","JSON","stringify","type","onclose","delay","Math","min","pow","setTimeout","concat","onerror","error","joinGame","gameId","readyState","OPEN","leaveGame","sendMessage","message","clearTimeout","close","value","ws","Provider","useWebSocket","context","Error"],"sources":["/Users/krishdembla/Desktop/poker-debt-app/webui/src/context/WebSocketContext.jsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useRef, useState } from 'react';\n\nconst WebSocketContext = createContext();\n\nexport const WebSocketProvider = ({ children }) => {\n  const [isConnected, setIsConnected] = useState(false);\n  const [currentGameId, setCurrentGameId] = useState(null);\n  const wsRef = useRef(null);\n  const reconnectTimeoutRef = useRef(null);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n\n  const connect = () => {\n    const token = localStorage.getItem('poker_token');\n    if (!token) return;\n\n    const wsUrl = process.env.REACT_APP_WS_URL || 'ws://localhost:5050';\n    wsRef.current = new WebSocket(wsUrl);\n\n    wsRef.current.onopen = () => {\n      console.log('WebSocket connected');\n      setIsConnected(true);\n      reconnectAttempts.current = 0;\n      \n      // Authenticate the connection\n      wsRef.current.send(JSON.stringify({\n        type: 'auth',\n        token\n      }));\n    };\n\n    wsRef.current.onclose = () => {\n      console.log('WebSocket disconnected');\n      setIsConnected(false);\n      \n      // Attempt to reconnect\n      if (reconnectAttempts.current < maxReconnectAttempts) {\n        reconnectAttempts.current++;\n        const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current), 10000);\n        \n        reconnectTimeoutRef.current = setTimeout(() => {\n          console.log(`Attempting to reconnect (${reconnectAttempts.current}/${maxReconnectAttempts})`);\n          connect();\n        }, delay);\n      }\n    };\n\n    wsRef.current.onerror = (error) => {\n      console.error('WebSocket error:', error);\n    };\n  };\n\n  const joinGame = (gameId) => {\n    if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify({\n        type: 'join_game',\n        gameId\n      }));\n      setCurrentGameId(gameId);\n    }\n  };\n\n  const leaveGame = () => {\n    setCurrentGameId(null);\n  };\n\n  const sendMessage = (message) => {\n    if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {\n      wsRef.current.send(JSON.stringify(message));\n    }\n  };\n\n  useEffect(() => {\n    connect();\n\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n      if (wsRef.current) {\n        wsRef.current.close();\n      }\n    };\n  }, []);\n\n  const value = {\n    isConnected,\n    currentGameId,\n    joinGame,\n    leaveGame,\n    sendMessage,\n    ws: wsRef.current\n  };\n\n  return (\n    <WebSocketContext.Provider value={value}>\n      {children}\n    </WebSocketContext.Provider>\n  );\n};\n\nexport const useWebSocket = () => {\n  const context = useContext(WebSocketContext);\n  if (!context) {\n    throw new Error('useWebSocket must be used within a WebSocketProvider');\n  }\n  return context;\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}